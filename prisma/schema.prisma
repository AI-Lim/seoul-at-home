// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // or "mysql", "sqlite", etc.
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  phone     String?
  createdAt DateTime  @default(now())
  bookings  Booking[]
}

model Booking {
  id             String          @id @default(cuid())
  userId         String
  user           User            @relation(fields: [userId], references: [id])
  selectedPass   String
  passPrice      Int
  totalAmount    Int
  status         BookingStatus   @default(PENDING)
  createdAt      DateTime        @default(now())
  koreanIdentity KoreanIdentity?
  tontine        Tontine?
  payments        Payment[]
  ticket         Ticket?
}

enum BookingStatus {
  PENDING
  TONTINE
  PAID
  CANCELLED
}

model KoreanIdentity {
  id            String   @id @default(cuid())
  bookingId     String   @unique
  booking       Booking  @relation(fields: [bookingId], references: [id])
  hangul        String
  koreanName    String
  pronunciation String
  meaning       String
  gender        String
  mood          String
}

model Tontine {
  id              String        @id @default(cuid())
  bookingId       String        @unique
  booking         Booking       @relation(fields: [bookingId], references: [id])
  totalBoxes      Int           @default(10)
  paidBoxes       Int           @default(0)
  amountPaid      Int           @default(0)
  remainingAmount Int           @default(0)
  status          TontineStatus @default(IN_PROGRESS)
  updatedAt       DateTime      @updatedAt
}

enum TontineStatus {
  IN_PROGRESS
  COMPLETE
}

model Payment {
  id          String    @id @default(cuid())
  bookingId   String    
  operator    String
  phone       String
  amount      Int
  status      String    @default("PENDING")
  externalRef String?
  senderPhone String?
  adminNote   String?
  paidAt      DateTime?
  updatedAt   DateTime  @updatedAt
  createdAt   DateTime  @default(now())
  booking     Booking   @relation(fields: [bookingId], references: [id])
}
enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

model Ticket {
  id         String    @id @default(cuid())
  bookingId  String    @unique
  booking    Booking   @relation(fields: [bookingId], references: [id])
  ticketCode String    @unique
  qrData     String
  scannedAt  DateTime?
  isValid    Boolean   @default(true)
  createdAt  DateTime  @default(now())
}
model EventConfig {
  id              String   @id @default(cuid())
  seoulEntryTotal Int      @default(100)
  neonVibeTotal   Int      @default(50)
  updatedAt       DateTime @updatedAt
}